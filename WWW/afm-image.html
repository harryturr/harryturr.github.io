<!DOCTYPE html>
<html lang='en'>
  <head>
    <!-- <script src='http://localhost:3000/build/plotly.js'></script> -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
      html, body {
        margin:0; padding:0;
      }
      #grid {
        display: grid;
        width: 90vw;
        height: 80vh;
        margin-left:5vw;
        grid-template-columns: 1fr 1fr;
      }

      #grid > div {
        display:inline-block;
      }

      #loading {

      }
    </style>
  </head>
  <body>
    <h1 id="title">afm image</h1>
    <button onclick="restyle()">Restyle</button>
    <div id="grid">
      <div id="gd1"></div>
      <div id="gd2"></div>
    </div>

    <script>
    window.toggle = true
    function restyle() {
      window.toggle = !window.toggle
      var newTraceType;
      if(window.toggle) newTraceType='heatmap'
      if(!window.toggle) newTraceType='surface'
      Plotly.restyle('gd1','type', newTraceType)
      Plotly.restyle('gd2','type', newTraceType)
    }
    function getImageInfo(imageUrl) {
      axios.get(imageUrl)
      .then(function(response) {
        var image = response.data
        document.getElementById('title').innerText = `Bias ${image.Bias}, T=${image.Temperature}`;
        console.log(image)
      })
    }
    function plotChannel(gd, channelUrl) {
      var margin = {l:0, r:0, t:30, b:0}
      axios.get(channelUrl)
      .then(function(response) {
        var channel = response.data
        var arr = channel.data
        var newArr = [];
        while(arr.length) newArr.push(arr.splice(0,256));

        var p = [
          Plotly.newPlot(gd,[{type: 'surface', z: newArr, colorscale: 'Greys'}], {
            title: channel.title,
            margin: margin,
            xaxis: {
              showgrid: false,
              zeroline: false,
              showline: false
            },
            yaxis: {
              scaleanchor: "x",
              showgrid: false,
              zeroline: false,
              showline: false
            }
          }, {responsive: true})
        ]

        Promise.all(p)
        .then(function() {
          // document.getElementById('status').innerText = 'Done';
        })
        .catch(function() {
          // document.getElementById('status').innerText = 'Failed'
        })
      })
    }
    getImageInfo('image.json')
    plotChannel('gd1', './channel/samw_23April/channel0.json')
    plotChannel('gd2', './channel/samw_23April/channel2.json')
    </script>
  </body>
</html>